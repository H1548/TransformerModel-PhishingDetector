# Fine-grained Phishing Email Detection using Transformer-Based Model

This project pre-trains and fine-tunes a transformer-based model to detect multiple types of phishing emails. Not only does the model's output classify emails but also provides:
- Recommended actions
- User advice 
- An AI-generated precautionary disclaimer

For pretraining, the dataset used was the openwebtext dataset, however, for fine-tuning the dataset used was sythetically generated by chatgpt 5 consisting of: 

- Phishing examples 
- legitimtate examples 
- each labled 
- 'email, label' format

The classification classes are: 

- 'Phishing-payment': target label is for emails that manipulate users into handing over their bank/financial details by using fake invoices, bank alerts and payment requests,
- 'Phishing-delivery': label is for emails that pretend to be a delivery services that is delivering a parcel, prying user information for identity theft, 
- 'Phishing-techsupport': label is for emails acting as a tech company offering support but are trying to steal your system's credentials,
- 'Phishing-job': label is for adversaries mimicking employers offering jobs, so users can enter their private details or click a malicious link, 
- 'Safe-work': label for legitimate work-related emails that may consist reports, matters related to projects, etc,
- 'Safe-personal': label for legitimate emails users receive from friends and families, 
- 'Safe-marketing': label for legitimate emails from businesses sell their services, 
- 'Safe-transactional': label for legitimate emails for confirmed purchases made by the user, shipping updates or receipts

## Output Structure
When the final model is prompted with an input email, the model predicts a class, a function is then used in the prompt code to collect information from the 'advice.json' with respect to the predicted class. 
The final output from the phishing detector is structured as:
- phishing-credential
- recommended_action: Do not click links or enter credentials; report and delete.
- user_advice: Access accounts by typing the official URL or using a trusted app/bookmark. If you interacted, immediately change your password on the real site and revoke any suspicious sessions/MFA methods.
- ai-disclaimer: Note: This recommendation was generated by an AI system. Please follow the company's security policy if unsure.

# Features
- Phishing Detector
- MultiClass Classifiction
- Sythetic email generation script
- Transformer-based model pretrained and fine-tuned from scrath using **Pytorch** 
- Pretraining code uses Masked Language Modelling (MLM) from BERT

# Installation
## Clone the repository
<pre>bash git clone https://github.com/H1548/TransformerModel-PhishingDetector.git</pre>
<pre>bash cd TransformerModel-PhishingDetector</pre>

## Install dependencies
<pre>pip install -r requirements.txt</pre>

# Usage

## Pretrain Transformer
<pre>python pretrainingloop.py</pre>

## Generate synthetic Emails
<pre>cd Dataset</pre>
<pre>python generate_emails.py --out emails.csv --per-label 500 --seed 1337</pre>
Note: Script was made entirely by GPT 5 for the generation of the emails.
'--per-label' defines how many emails you want generated per-label so 500 = 500 * 9 = 4500 total emails in dataset

## Finetune model 
<pre>python FineTuneTrainingLoop.py</pre>

## Test model 
<pre>python modelTest.py</pre>
you can go within this file and change the test set to another one of the your own, and the results of the model will be stored in the 'Results' directory. 
Furhtermore, once this file is run the **loss**, **accuracy**, and the **F1-score** will be displayed in you terminal/command prompt.
The results that are stored in the 'Resutls' Directory are:

- classification report - derived from sckit-learn
- Confusion matrix - also derived from sckit-learn

## Example Output
When prompting the file, using the Prompter.py file, the model should display an output as shown below: 

"phishing-techsupport: Recommended Action: Do not grant remote access or install software; contact official IT/support. User Advice: Legitimate support won't cold-contact demanding immediate action or payment. If concerned, reach your IT desk or vendor using official contact info and portal. Keep endpoint protection updated.
Ai Disclaimer: Note: This recommendation was generated by an AI system. Please follow the company's security policy if unsure."

 ## Results
** Accuracy: 99% ** 
 ** F1-score: 0.99 **
<img src="images/confusion_matrix.png" alt="Confusion Matrix" width="500" height ="500"/>